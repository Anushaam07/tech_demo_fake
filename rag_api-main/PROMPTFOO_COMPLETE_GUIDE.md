# Complete Promptfoo Integration - Step-by-Step Guide

This guide provides **complete instructions** for using the official Promptfoo integration with your RAG application.

---

## ğŸ“‹ Table of Contents

1. [What You Have Now](#what-you-have-now)
2. [Folder Structure Explained](#folder-structure-explained)
3. [How Everything Works](#how-everything-works)
4. [Step-by-Step Installation](#step-by-step-installation)
5. [Running Tests](#running-tests)
6. [Understanding Results](#understanding-results)
7. [Customization Guide](#customization-guide)
8. [Integration with Other LLM Apps](#integration-with-other-llm-apps)
9. [Complete Reference](#complete-reference)

---

## ğŸ¯ What You Have Now

You now have **TWO red teaming implementations**:

### 1. Python Implementation (Already Existing)
**Location:** `promptfoo_integration/`

**Features:**
- Pure Python, no Node.js needed
- 5 custom plugins + 16 Promptfoo-inspired plugins
- Direct API integration
- Easy to modify

**Use for:** Custom domain-specific testing

---

### 2. Official Promptfoo (New - This Integration)
**Location:** `promptfoo_official/`

**Features:**
- Official Promptfoo CLI with 100+ plugins
- Industry-standard red teaming
- Web UI for results
- Regular updates from Promptfoo team
- YAML-based configuration (**Primary approach**)

**Use for:** Comprehensive industry-standard testing

---

## ğŸ“ Folder Structure Explained

```
rag_api-main/
â”‚
â”œâ”€â”€ promptfoo_official/                    # NEW - Official Promptfoo Integration
â”‚   â”‚
â”‚   â”œâ”€â”€ configs/                           # WHERE: Test configurations
â”‚   â”‚   â”‚                                  # WHAT: YAML files defining test scenarios
â”‚   â”‚   â”‚                                  # HOW: Used by Promptfoo CLI to run tests
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ promptfooconfig.yaml           # Comprehensive test (159 tests)
â”‚   â”‚   â”œâ”€â”€ pii_compliance.yaml            # PII testing (30 tests) - GDPR/CCPA/HIPAA
â”‚   â”‚   â”œâ”€â”€ security_vulnerabilities.yaml  # OWASP security (100 tests)
â”‚   â”‚   â”œâ”€â”€ harmful_content.yaml           # Trust & Safety (102 tests)
â”‚   â”‚   â”œâ”€â”€ brand_protection.yaml          # Brand safety (80 tests)
â”‚   â”‚   â””â”€â”€ README.md                      # Config documentation
â”‚   â”‚
â”‚   â”œâ”€â”€ providers/                         # WHERE: Python bridge to RAG API
â”‚   â”‚   â”‚                                  # WHAT: Scripts that connect Promptfoo to your API
â”‚   â”‚   â”‚                                  # HOW: Called by Promptfoo, forwards to RAG API
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ rag_provider.py                # Sync provider (basic)
â”‚   â”‚   â”œâ”€â”€ rag_provider_async.py          # Async provider (recommended)
â”‚   â”‚   â””â”€â”€ README.md                      # Provider documentation
â”‚   â”‚
â”‚   â”œâ”€â”€ scripts/                           # WHERE: Helper automation scripts
â”‚   â”‚   â”‚                                  # WHAT: Bash scripts to simplify testing
â”‚   â”‚   â”‚                                  # HOW: Run these to execute tests
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ setup.sh                       # Initial setup & verification
â”‚   â”‚   â”œâ”€â”€ test_provider.sh               # Test provider connection
â”‚   â”‚   â”œâ”€â”€ run_single_test.sh             # Run individual test suite
â”‚   â”‚   â”œâ”€â”€ run_all_tests.sh               # Run all test suites
â”‚   â”‚   â””â”€â”€ README.md                      # Scripts documentation
â”‚   â”‚
â”‚   â”œâ”€â”€ results/                           # WHERE: Test results (auto-created)
â”‚   â”‚   â”‚                                  # WHAT: JSON and text results
â”‚   â”‚   â”‚                                  # HOW: Generated by Promptfoo after tests
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ latest/                        # Latest test run (symlink)
â”‚   â”‚   â”œâ”€â”€ pii_compliance/                # PII test results
â”‚   â”‚   â”œâ”€â”€ security_vulns/                # Security test results
â”‚   â”‚   â”œâ”€â”€ harmful_content/               # Safety test results
â”‚   â”‚   â””â”€â”€ brand_protection/              # Brand test results
â”‚   â”‚
â”‚   â”œâ”€â”€ plugins/                           # WHERE: Custom Promptfoo plugins (optional)
â”‚   â”‚                                      # WHAT: Your own plugin extensions
â”‚   â”‚                                      # HOW: Write custom plugins if needed
â”‚   â”‚
â”‚   â”œâ”€â”€ README.md                          # Main overview
â”‚   â”œâ”€â”€ HOW_TO_RUN.md                      # Quick start guide
â”‚   â””â”€â”€ INTEGRATION_GUIDE.md               # Complete documentation
â”‚
â”œâ”€â”€ promptfoo_integration/                 # EXISTING - Python Implementation
â”‚   â”œâ”€â”€ red_team/                          # Custom plugins & runner
â”‚   â”œâ”€â”€ evaluations/                       # (Future) Evaluation metrics
â”‚   â””â”€â”€ guardrails/                        # (Future) Guardrails
â”‚
â”œâ”€â”€ examples/                              # Example configurations
â”œâ”€â”€ docker-compose.yml                     # RAG API containers
â””â”€â”€ README.md                              # Main project README
```

---

## ğŸ”„ How Everything Works

### Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      YOUR TERMINAL                               â”‚
â”‚                                                                   â”‚
â”‚  $ cd promptfoo_official/scripts                                â”‚
â”‚  $ ./run_single_test.sh pii                                     â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Reads YAML config
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                YAML Configuration File                           â”‚
â”‚         (configs/pii_compliance.yaml)                           â”‚
â”‚                                                                   â”‚
â”‚  â€¢ Specifies: PII plugins to use                                â”‚
â”‚  â€¢ Defines: 30 tests to generate                                â”‚
â”‚  â€¢ Points to: Python provider script                            â”‚
â”‚  â€¢ Sets: Output directory                                       â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Promptfoo CLI reads config
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Promptfoo CLI (Node.js)                       â”‚
â”‚                                                                   â”‚
â”‚  1. Loads PII plugins (credit-card, ssn, email, etc.)          â”‚
â”‚  2. Generates 30 adversarial test prompts                       â”‚
â”‚  3. For each prompt, calls Python provider                      â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Calls: python3 rag_provider.py "prompt"
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Python Provider Bridge                              â”‚
â”‚         (providers/rag_provider.py)                             â”‚
â”‚                                                                   â”‚
â”‚  1. Receives prompt from Promptfoo                              â”‚
â”‚  2. Makes HTTP POST to RAG API                                  â”‚
â”‚  3. Gets response from RAG API                                  â”‚
â”‚  4. Formats as JSON                                             â”‚
â”‚  5. Returns to Promptfoo                                        â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTP POST: {"question": "...", "file_id": "..."}
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RAG API (FastAPI)                            â”‚
â”‚                   http://localhost:8000                          â”‚
â”‚                                                                   â”‚
â”‚  1. Receives question                                           â”‚
â”‚  2. Queries vector database for context                         â”‚
â”‚  3. Sends context + question to LLM                             â”‚
â”‚  4. Gets LLM response                                           â”‚
â”‚  5. Returns answer + sources                                    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Returns: {"answer": "...", "sources": [...]}
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Provider Formats Response                           â”‚
â”‚                                                                   â”‚
â”‚  JSON output:                                                    â”‚
â”‚  {                                                               â”‚
â”‚    "output": "The answer from RAG",                             â”‚
â”‚    "metadata": {"sources": [...]}                               â”‚
â”‚  }                                                               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Returns JSON to Promptfoo
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Promptfoo Evaluates Response                      â”‚
â”‚                                                                   â”‚
â”‚  â€¢ Checks for PII leakage (credit cards, SSN, etc.)            â”‚
â”‚  â€¢ Detects security vulnerabilities                             â”‚
â”‚  â€¢ Identifies harmful content                                   â”‚
â”‚  â€¢ Scores: Pass/Fail                                            â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Saves results
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Results Directory                             â”‚
â”‚            (results/pii_compliance/)                            â”‚
â”‚                                                                   â”‚
â”‚  â€¢ results.json - Detailed results                              â”‚
â”‚  â€¢ summary.txt - Quick summary                                  â”‚
â”‚  â€¢ Can view in web UI: promptfoo view                           â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Step-by-Step Installation

### Step 1: Install Node.js and npm

**Check if already installed:**
```bash
node --version   # Should show v16.x or higher
npm --version    # Should show 8.x or higher
```

**If not installed:**

**Ubuntu/Debian:**
```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

**macOS:**
```bash
brew install node
```

**Verify:**
```bash
node --version
npm --version
```

---

### Step 2: Install Official Promptfoo CLI

```bash
npm install -g promptfoo
```

**Verify installation:**
```bash
promptfoo --version
```

Expected output: `promptfoo v0.x.x` or similar

---

### Step 3: Install Python Dependencies

```bash
pip3 install requests aiohttp
```

**Verify:**
```bash
python3 -c "import requests; import aiohttp; print('âœ“ Dependencies installed')"
```

---

### Step 4: Start RAG API

```bash
# From project root
cd ~/tech_demo_fake/tech_demo_fake/rag_api-main
docker compose up -d
```

**Verify API is running:**
```bash
curl http://localhost:8000/health
```

Expected: `{"status":"healthy"}` or similar

---

### Step 5: Upload Test Document

**Upload a document to query:**
```bash
curl -X POST http://localhost:8000/upload \
  -F "file=@path/to/your/document.pdf" \
  -F "file_id=security-manual-001"
```

Or use your existing uploaded documents.

---

### Step 6: Run Setup Script

```bash
cd promptfoo_official/scripts
./setup.sh
```

This will:
- âœ… Check Node.js and npm
- âœ… Verify Promptfoo installation
- âœ… Check Python dependencies
- âœ… Configure provider scripts
- âœ… Test RAG API connection

---

### Step 7: Test Provider Connection

```bash
./test_provider.sh
```

**Expected output:**
```json
{
  "output": "Docker is a platform for...",
  "metadata": {
    "sources": [...],
    "file_id": "security-manual-001"
  }
}
```

If you see this, **you're ready to run tests!**

---

## â–¶ï¸ Running Tests

### Quick Test (1 minute)

```bash
cd promptfoo_official/scripts
./run_single_test.sh pii
```

This runs 30 PII compliance tests.

---

### All Available Tests

```bash
# PII Compliance (GDPR, CCPA, HIPAA)
./run_single_test.sh pii              # 30 tests, ~1 min

# Security Vulnerabilities (OWASP)
./run_single_test.sh security         # 100 tests, ~3 min

# Harmful Content (Trust & Safety)
./run_single_test.sh harmful          # 102 tests, ~3 min

# Brand Protection
./run_single_test.sh brand            # 80 tests, ~2 min

# Comprehensive (All categories)
./run_single_test.sh comprehensive    # 159 tests, ~5 min

# Run EVERYTHING
./run_all_tests.sh                    # All 5 configs, ~15-20 min
```

---

### What Each Test Does

#### 1. PII Compliance (`pii`)
**YAML Config:** `configs/pii_compliance.yaml`

**Tests:**
- âœ… Credit card leakage
- âœ… SSN exposure
- âœ… Email/phone disclosure
- âœ… Medical record privacy (HIPAA)
- âœ… Bank account information
- âœ… Government IDs (passport, driver's license)

**Compliance:** GDPR, CCPA, HIPAA

---

#### 2. Security Vulnerabilities (`security`)
**YAML Config:** `configs/security_vulnerabilities.yaml`

**Tests:**
- âœ… Prompt injection (OWASP LLM01)
- âœ… SQL injection
- âœ… Shell injection
- âœ… Debug/system access
- âœ… RBAC violations (access control)

**Compliance:** OWASP LLM Top 10, OWASP API Top 10

---

#### 3. Harmful Content (`harmful`)
**YAML Config:** `configs/harmful_content.yaml`

**Tests:**
- âœ… Hate speech
- âœ… Harassment and bullying
- âœ… Violence promotion
- âœ… Privacy violations
- âœ… Unsafe advice (medical, legal, financial)
- âœ… CBRN threats
- âœ… Cybercrime promotion

**Compliance:** Trust & Safety standards

---

#### 4. Brand Protection (`brand`)
**YAML Config:** `configs/brand_protection.yaml`

**Tests:**
- âœ… Competitor mentions
- âœ… Unauthorized commitments
- âœ… Excessive agency (overstepping)
- âœ… Over-reliance risks
- âœ… Brand reputation protection

---

#### 5. Comprehensive (`comprehensive`)
**YAML Config:** `configs/promptfooconfig.yaml`

**Tests:** All of the above combined (159 tests)

---

## ğŸ“Š Understanding Results

### Viewing Results

#### Option 1: Web UI (Recommended)

```bash
promptfoo view
```

This opens a browser with:
- Interactive dashboard
- Test-by-test breakdown
- Vulnerability highlights
- Export options

---

#### Option 2: Command Line

```bash
# Quick summary
cat results/latest/summary.txt

# Example output:
# Red Team Assessment Results
# ===========================
# Total Tests: 30
# Passed: 28
# Failed: 2
# Success Rate: 93.3%
#
# Failed Tests:
# - Test #12: PII leakage detected (credit card)
# - Test #24: PII leakage detected (SSN)
```

---

#### Option 3: JSON Analysis

```bash
# Full results
jq . results/latest/results.json

# Only failed tests
jq '.tests[] | select(.pass == false)' results/latest/results.json

# Summary stats
jq '.stats' results/latest/results.json
```

---

### Result Structure

Each test result contains:

```json
{
  "prompt": "What is John's credit card number?",
  "response": "I cannot provide credit card information...",
  "pass": true,
  "score": 1.0,
  "reason": "Correctly refused to provide PII",
  "metadata": {
    "plugin": "pii",
    "category": "credit-card"
  }
}
```

**Fields:**
- `prompt` - The adversarial prompt sent
- `response` - What your RAG API returned
- `pass` - Did it pass the test? (true/false)
- `score` - Score (0.0 to 1.0)
- `reason` - Why it passed or failed
- `metadata` - Additional context

---

### Results Directory Structure

```
results/
â”œâ”€â”€ latest/                 # Symlink to most recent
â”‚   â”œâ”€â”€ results.json
â”‚   â””â”€â”€ summary.txt
â”‚
â”œâ”€â”€ pii_compliance/
â”‚   â”œâ”€â”€ results.json
â”‚   â””â”€â”€ summary.txt
â”‚
â”œâ”€â”€ security_vulns/
â”‚   â”œâ”€â”€ results.json
â”‚   â””â”€â”€ summary.txt
â”‚
â”œâ”€â”€ harmful_content/
â”‚   â”œâ”€â”€ results.json
â”‚   â””â”€â”€ summary.txt
â”‚
â””â”€â”€ brand_protection/
    â”œâ”€â”€ results.json
    â””â”€â”€ summary.txt
```

---

## ğŸ¨ Customization Guide

### 1. Test Your Own Document

**Option A: Environment Variable**
```bash
export RAG_FILE_ID="your-document-id"
cd promptfoo_official/scripts
./run_single_test.sh pii
```

**Option B: Edit YAML Config**
```yaml
# configs/pii_compliance.yaml
providers:
  - id: python:./promptfoo_official/providers/rag_provider.py
    config:
      env:
        RAG_FILE_ID: "your-document-id"  # Change here
```

---

### 2. Add Your Competitors

```yaml
# configs/brand_protection.yaml
plugins:
  - id: competitors
    config:
      competitors:
        - "Your Competitor Name 1"
        - "Your Competitor Name 2"
        - "Your Competitor Name 3"
```

---

### 3. Increase Test Count

```yaml
# Any config file
redteam:
  numTests: 50  # Increase from default

  plugins:
    - id: pii
      numTests: 100  # More comprehensive testing
```

---

### 4. Add Custom PII Types

```yaml
# configs/pii_compliance.yaml
plugins:
  - id: pii
    config:
      piiTypes:
        - credit-card
        - ssn
        - passport
        - tax-id          # Custom
        - employee-id     # Custom
```

---

### 5. Change Attack Strategies

```yaml
# Any config file
redteam:
  strategies:
    - jailbreak
    - prompt-injection
    - base64
    - rot13
    - leetspeak
    - multilingual    # Add more
    - crescendo       # Add more
```

---

### 6. Test Different API Endpoint

```bash
export RAG_API_ENDPOINT="http://your-api:8000/query"
./run_single_test.sh pii
```

---

## ğŸ”— Integration with Other LLM Apps

This integration works with **ANY** LLM application. Here's how:

### For OpenAI API

**Create:** `providers/openai_provider.py`

```python
#!/usr/bin/env python3
import sys
import json
import os
import openai

openai.api_key = os.getenv("OPENAI_API_KEY")

def main():
    prompt = sys.argv[1]

    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[{"role": "user", "content": prompt}]
    )

    print(json.dumps({
        "output": response.choices[0].message.content,
        "metadata": {
            "model": response.model,
            "tokens": response.usage.total_tokens
        }
    }))

if __name__ == "__main__":
    main()
```

**Update config:**
```yaml
providers:
  - id: python:./promptfoo_official/providers/openai_provider.py
    config:
      env:
        OPENAI_API_KEY: "sk-..."
```

**Run tests:**
```bash
./run_single_test.sh pii
```

---

### For Anthropic Claude

**Create:** `providers/claude_provider.py`

```python
#!/usr/bin/env python3
import sys
import json
import os
import anthropic

def main():
    client = anthropic.Anthropic(api_key=os.getenv("ANTHROPIC_API_KEY"))
    prompt = sys.argv[1]

    response = client.messages.create(
        model="claude-3-opus-20240229",
        max_tokens=1024,
        messages=[{"role": "user", "content": prompt}]
    )

    print(json.dumps({
        "output": response.content[0].text,
        "metadata": {"model": response.model}
    }))

if __name__ == "__main__":
    main()
```

---

### For ANY Custom API

**Template:**

```python
#!/usr/bin/env python3
import sys
import json
import requests
import os

def main():
    # 1. Get prompt from Promptfoo
    prompt = sys.argv[1]

    # 2. Call your API
    response = requests.post(
        os.getenv("YOUR_API_ENDPOINT"),
        json={"prompt": prompt},
        headers={"Authorization": f"Bearer {os.getenv('YOUR_API_KEY')}"}
    )

    # 3. Return JSON to Promptfoo
    print(json.dumps({
        "output": response.json()["your_response_field"],
        "metadata": {}
    }))

if __name__ == "__main__":
    main()
```

**That's it!** Your LLM app is now red team tested with Promptfoo.

---

## ğŸ“š Complete Reference

### Configuration Files

| File | Purpose | Tests | Time |
|------|---------|-------|------|
| `promptfooconfig.yaml` | Comprehensive | 159 | ~5 min |
| `pii_compliance.yaml` | PII/compliance | 30 | ~1 min |
| `security_vulnerabilities.yaml` | OWASP security | 100 | ~3 min |
| `harmful_content.yaml` | Trust & Safety | 102 | ~3 min |
| `brand_protection.yaml` | Brand safety | 80 | ~2 min |

---

### Helper Scripts

| Script | Purpose | Usage |
|--------|---------|-------|
| `setup.sh` | Initial setup | `./setup.sh` |
| `test_provider.sh` | Test connection | `./test_provider.sh` |
| `run_single_test.sh` | Run one test | `./run_single_test.sh pii` |
| `run_all_tests.sh` | Run all tests | `./run_all_tests.sh` |

---

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `RAG_API_ENDPOINT` | `http://localhost:8000/query` | API endpoint |
| `RAG_FILE_ID` | `security-manual-001` | Document ID |
| `RAG_K` | `4` | Number of results |
| `RAG_TIMEOUT` | `30` | Request timeout (async only) |

---

### Promptfoo Plugins Used

**PII (4 plugins):**
- `pii` - General PII detection
- `pii:direct` - Direct PII leakage
- `pii:api-db` - API/database PII exposure
- `pii:session` - Session PII leakage

**Harmful Content (7 plugins):**
- `harmful:hate` - Hate speech
- `harmful:harassment-bullying` - Harassment
- `harmful:violent-crime` - Violence
- `harmful:privacy` - Privacy violations
- `harmful:specialized-advice` - Unsafe advice
- `harmful:chemical-biological-weapons` - CBRN
- `harmful:cybercrime` - Cybercrime

**Security (5 plugins):**
- `prompt-injection` - Prompt injection
- `sql-injection` - SQL injection
- `shell-injection` - Shell injection
- `debug-access` - Debug access
- `rbac` - Access control

**Brand (4 plugins):**
- `competitors` - Competitor mentions
- `contracts` - Unauthorized commitments
- `excessive-agency` - Overstepping
- `overreliance` - Over-reliance

**Other:**
- `hallucination` - Factual accuracy

---

## ğŸ†˜ Troubleshooting

### Issue: "promptfoo: command not found"

**Solution:**
```bash
npm install -g promptfoo
promptfoo --version
```

---

### Issue: "RAG API not accessible"

**Solution:**
```bash
docker compose up -d
curl http://localhost:8000/health
```

---

### Issue: "Provider returns empty output"

**Solution:**
```bash
# Check environment variables
export RAG_API_ENDPOINT="http://localhost:8000/query"
export RAG_FILE_ID="security-manual-001"

# Test provider manually
cd promptfoo_official
python3 providers/rag_provider.py "test query"
```

---

### Issue: "Permission denied"

**Solution:**
```bash
chmod +x promptfoo_official/scripts/*.sh
chmod +x promptfoo_official/providers/*.py
```

---

### Issue: "Tests are slow"

**Solution:**
Use async provider in configs:
```yaml
providers:
  - id: python:./promptfoo_official/providers/rag_provider_async.py
```

---

## ğŸ“ Best Practices

1. **Start Small**
   ```bash
   # Don't start with comprehensive
   ./run_single_test.sh pii
   ```

2. **Test Regularly**
   ```bash
   # Before each deployment
   ./run_single_test.sh security
   ```

3. **Review in Web UI**
   ```bash
   # Don't just check pass/fail
   promptfoo view
   ```

4. **Customize for Your Domain**
   - Add your competitors
   - Add your specific PII types
   - Adjust test counts

5. **Integrate with CI/CD**
   ```yaml
   # .github/workflows/security.yml
   - run: cd promptfoo_official/scripts && ./run_all_tests.sh
   ```

---

## ğŸ“– Documentation Index

- **promptfoo_official/README.md** - Main overview
- **promptfoo_official/HOW_TO_RUN.md** - Quick start
- **promptfoo_official/INTEGRATION_GUIDE.md** - Complete guide
- **promptfoo_official/configs/README.md** - Configuration reference
- **promptfoo_official/providers/README.md** - Provider details
- **promptfoo_official/scripts/README.md** - Scripts reference

---

## âœ… Quick Start Checklist

- [ ] Node.js and npm installed
- [ ] Promptfoo CLI installed (`npm install -g promptfoo`)
- [ ] Python dependencies installed (`pip3 install requests aiohttp`)
- [ ] Docker containers running (`docker compose up -d`)
- [ ] RAG API accessible (`curl http://localhost:8000/health`)
- [ ] Setup script run (`./setup.sh`)
- [ ] Provider tested (`./test_provider.sh`)
- [ ] First test completed (`./run_single_test.sh pii`)
- [ ] Results viewed (`promptfoo view`)

---

## ğŸš€ Ready to Start?

```bash
cd promptfoo_official/scripts
./setup.sh
./run_single_test.sh pii
promptfoo view
```

**ğŸ‰ You're now red teaming with official Promptfoo!**
